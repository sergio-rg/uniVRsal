<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Invitación de Boda VR - Ana & Carlos</title>
    <meta name="description" content="Invitación interactiva de boda">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #87CEEB;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
            cursor: pointer;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.2em;
            text-align: center;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 100;
        }
        
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        
        .video-container {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .video-container video {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        
        .close-video {
            position: absolute;
            top: -40px;
            right: 0;
            background: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
        }

        .scene-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2em;
            text-align: center;
            z-index: 10;
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div>
            <h2>✈️ Preparando tu invitación especial ✈️</h2>
            <p>Cargando experiencia 3D...</p>
        </div>
    </div>

    <div class="instructions" id="instructions">
        Haz clic en los objetos para interactuar
    </div>

    <div class="scene-text" id="sceneText">
        ¡Bienvenidos a nuestra aventura!<br>
        <small>Haz clic en la maleta para comenzar</small>
    </div>

    <div class="video-overlay" id="videoOverlay">
        <div class="video-container">
            <button class="close-video" onclick="closeVideo()">×</button>
            <video id="coupleVideo" controls>
                <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
                Tu navegador no soporta el elemento video.
            </video>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script>
        // Variables globales
        let scene, camera, renderer, raycaster, mouse;
        let currentScene = 1;
        let suitcase, screen, invitation;
        let clickableObjects = [];

        // Inicializar Three.js
        function init() {
            console.log('Inicializando experiencia 3D...');
            
            // Crear escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // Crear cámara
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 5);

            // Crear renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Raycaster para detectar clics
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Añadir luces
            addLights();

            // Crear escena 1
            createScene1();

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('click', onMouseClick);
            renderer.domElement.addEventListener('mousemove', onMouseMove);

            // Comenzar loop de renderizado
            animate();

            // Ocultar pantalla de carga
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                console.log('Experiencia 3D cargada correctamente');
            }, 2000);
        }

        function addLights() {
            // Luz ambiente
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // Luz direccional
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Luz puntual
            const pointLight = new THREE.PointLight(0xffffff, 0.5);
            pointLight.position.set(0, 3, 0);
            scene.add(pointLight);
        }

        function createScene1() {
            console.log('Creando escena 1 - Maleta');
            
            // Limpiar escena
            clearScene();

            // Suelo
            const floorGeometry = new THREE.PlaneGeometry(20, 20);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0xe0e0e0 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Crear maleta
            createSuitcase();

            // Añadir nubes
            createClouds();

            // Actualizar texto
            updateSceneText('¡Bienvenidos a nuestra aventura!', 'Haz clic en la maleta para comenzar');
        }

        function createSuitcase() {
            suitcase = new THREE.Group();

            // Cuerpo principal
            const bodyGeometry = new THREE.BoxGeometry(1.8, 1.2, 0.6);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.castShadow = true;
            suitcase.add(body);

            // Asa
            const handleGeometry = new THREE.TorusGeometry(0.4, 0.08, 8, 16);
            const handleMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });
            const handle = new THREE.Mesh(handleGeometry, handleMaterial);
            handle.position.y = 0.8;
            handle.rotation.x = Math.PI / 2;
            suitcase.add(handle);

            // Etiqueta
            const labelGeometry = new THREE.PlaneGeometry(0.8, 0.4);
            const labelMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const label = new THREE.Mesh(labelGeometry, labelMaterial);
            label.position.set(0, 0, 0.31);
            suitcase.add(label);

            // Ruedas
            const wheelGeometry = new THREE.CylinderGeometry(0.15, 0.15, 0.08);
            const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            const wheel1 = new THREE.Mesh(wheelGeometry, wheelMaterial);
            wheel1.position.set(-0.7, -0.5, 0.35);
            wheel1.rotation.z = Math.PI / 2;
            suitcase.add(wheel1);

            const wheel2 = new THREE.Mesh(wheelGeometry, wheelMaterial);
            wheel2.position.set(0.7, -0.5, 0.35);
            wheel2.rotation.z = Math.PI / 2;
            suitcase.add(wheel2);

            // Posicionar y añadir a escena
            suitcase.position.set(0, 1.5, -2);
            scene.add(suitcase);
            clickableObjects.push(suitcase);

            // Animación de rotación
            suitcase.userData = { 
                type: 'suitcase',
                animate: true,
                rotationSpeed: 0.01
            };
        }

        function createClouds() {
            const cloudGeometry = new THREE.SphereGeometry(2, 8, 6);
            const cloudMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xffffff, 
                transparent: true, 
                opacity: 0.8 
            });

            const positions = [
                [-10, 8, -5],
                [8, 7, -8],
                [0, 9, -10]
            ];

            positions.forEach(pos => {
                const cloud = new THREE.Mesh(cloudGeometry, cloudMaterial);
                cloud.position.set(pos[0], pos[1], pos[2]);
                cloud.scale.set(
                    0.5 + Math.random() * 0.5,
                    0.5 + Math.random() * 0.5,
                    0.5 + Math.random() * 0.5
                );
                scene.add(cloud);
            });
        }

        function createScene2() {
            console.log('Creando escena 2 - Pantalla');
            
            clearScene();

            // Fondo oscuro
            scene.background = new THREE.Color(0x1a1a1a);

            // Suelo
            const floorGeometry = new THREE.PlaneGeometry(15, 15);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x2c3e50 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Crear pantalla
            createScreen();

            // Actualizar texto
            updateSceneText('Momento especial', 'Haz clic en la pantalla para ver nuestro mensaje');
        }

        function createScreen() {
            screen = new THREE.Group();

            // Marco
            const frameGeometry = new THREE.BoxGeometry(4, 2.5, 0.1);
            const frameMaterial = new THREE.MeshLambertMaterial({ color: 0x1c1c1c });
            const frame = new THREE.Mesh(frameGeometry, frameMaterial);
            screen.add(frame);

            // Pantalla
            const screenGeometry = new THREE.PlaneGeometry(3.6, 2.1);
            const screenMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x000000,
                emissive: 0x333333,
                emissiveIntensity: 0.1
            });
            const screenMesh = new THREE.Mesh(screenGeometry, screenMaterial);
            screenMesh.position.z = 0.06;
            screen.add(screenMesh);

            // Botón de play (triángulo)
            const playGeometry = new THREE.ConeGeometry(0.2, 0.3, 3);
            const playMaterial = new THREE.MeshLambertMaterial({ color: 0xff6b6b });
            const playButton = new THREE.Mesh(playGeometry, playMaterial);
            playButton.position.set(0, 0, 0.07);
            playButton.rotation.z = Math.PI / 2;
            screen.add(playButton);

            // Posicionar
            screen.position.set(0, 2, -3);
            scene.add(screen);
            clickableObjects.push(screen);

            screen.userData = { 
                type: 'screen',
                animate: true,
                pulseSpeed: 0.05
            };
        }

        function createScene3() {
            console.log('Creando escena 3 - Invitación');
            
            clearScene();

            // Fondo romántico
            scene.background = new THREE.Color(0xffeaa7);

            // Suelo
            const floorGeometry = new THREE.PlaneGeometry(20, 20);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0xdda0dd });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Crear invitación
            createInvitation();

            // Crear pétalos
            createPetals();

            // Actualizar texto
            updateSceneText('¡Nos casamos!', 'Ana & Carlos - 15 de Agosto, 2024<br>Haz clic para confirmar asistencia');
        }

        function createInvitation() {
            invitation = new THREE.Group();

            // Fondo de la invitación
            const cardGeometry = new THREE.PlaneGeometry(3, 4);
            const cardMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const card = new THREE.Mesh(cardGeometry, cardMaterial);
            invitation.add(card);

            // Decoración dorada (anillo)
            const ringGeometry = new THREE.RingGeometry(0.3, 0.4, 16);
            const ringMaterial = new THREE.MeshLambertMaterial({ color: 0xFFD700 });
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.position.set(0, 1.5, 0.01);
            invitation.add(ring);

            // Posicionar
            invitation.position.set(0, 2, -2);
            scene.add(invitation);
            clickableObjects.push(invitation);

            invitation.userData = { 
                type: 'invitation',
                animate: true,
                floatSpeed: 0.02
            };
        }

        function createPetals() {
            const petalGeometry = new THREE.SphereGeometry(0.1, 8, 6);
            const colors = [0xffb3ba, 0xffdfba, 0xffffba];
            
            for (let i = 0; i < 6; i++) {
                const petalMaterial = new THREE.MeshLambertMaterial({ 
                    color: colors[i % colors.length] 
                });
                const petal = new THREE.Mesh(petalGeometry, petalMaterial);
                
                petal.position.set(
                    (Math.random() - 0.5) * 10,
                    4 + Math.random() * 2,
                    (Math.random() - 0.5) * 6
                );
                
                petal.userData = {
                    fallSpeed: 0.02 + Math.random() * 0.02,
                    originalY: petal.position.y
                };
                
                scene.add(petal);
            }
        }

        function clearScene() {
            clickableObjects = [];
            
            // Remover todos los objetos excepto luces
            const objectsToRemove = [];
            scene.traverse((child) => {
                if (child !== scene && !(child instanceof THREE.Light)) {
                    objectsToRemove.push(child);
                }
            });
            
            objectsToRemove.forEach(obj => {
                scene.remove(obj);
            });
        }

        function updateSceneText(title, subtitle) {
            const textElement = document.getElementById('sceneText');
            textElement.innerHTML = `${title}<br><small>${subtitle}</small>`;
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Raycasting para hover effects
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects, true);
            
            document.body.style.cursor = intersects.length > 0 ? 'pointer' : 'default';
        }

        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects, true);

            if (intersects.length > 0) {
                const clickedObject = intersects[0].object.parent || intersects[0].object;
                
                if (clickedObject.userData.type === 'suitcase' && currentScene === 1) {
                    console.log('Clic en maleta');
                    currentScene = 2;
                    createScene2();
                    updateInstructions('Haz clic en la pantalla para ver el video');
                } else if (clickedObject.userData.type === 'screen' && currentScene === 2) {
                    console.log('Clic en pantalla');
                    showVideo();
                } else if (clickedObject.userData.type === 'invitation' && currentScene === 3) {
                    console.log('Clic en invitación');
                    window.open('https://ejemplo-confirmacion.com', '_blank');
                    alert('¡Redirigiendo a la página de confirmación! 💕');
                }
            }
        }

        function showVideo() {
            const videoOverlay = document.getElementById('videoOverlay');
            const video = document.getElementById('coupleVideo');
            
            videoOverlay.style.display = 'flex';
            video.play();
            
            video.onended = function() {
                closeVideo();
                setTimeout(() => {
                    currentScene = 3;
                    createScene3();
                    updateInstructions('Haz clic en la invitación para confirmar');
                }, 500);
            };
        }

        function closeVideo() {
            const videoOverlay = document.getElementById('videoOverlay');
            const video = document.getElementById('coupleVideo');
            
            videoOverlay.style.display = 'none';
            video.pause();
            video.currentTime = 0;
        }

        function updateInstructions(text) {
            document.getElementById('instructions').textContent = text;
        }

        function animate() {
            requestAnimationFrame(animate);

            // Animaciones de objetos
            scene.traverse((child) => {
                if (child.userData.animate) {
                    if (child.userData.type === 'suitcase') {
                        child.rotation.y += child.userData.rotationSpeed;
                    } else if (child.userData.type === 'screen') {
                        const scale = 1 + Math.sin(Date.now() * child.userData.pulseSpeed) * 0.05;
                        child.children[2].scale.set(scale, scale, scale); // Play button
                    } else if (child.userData.type === 'invitation') {
                        child.position.y = 2 + Math.sin(Date.now() * child.userData.floatSpeed) * 0.2;
                    }
                }

                // Animación de pétalos
                if (child.userData.fallSpeed) {
                    child.position.y -= child.userData.fallSpeed;
                    if (child.position.y < -2) {
                        child.position.y = child.userData.originalY;
                    }
                }
            });

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Inicializar cuando se cargue la página
        window.addEventListener('load', init);
    </script>
</body>
</html>